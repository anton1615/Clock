# 專案初衷
使用 .NET 10 WPF 開發的一個極簡番茄鐘工具。設計為 Widget 形式，懸浮於桌面或工作列上方，幫助使用者保持專注，同時不干擾工作流程。

# 產品定義 - Clock (番茄鐘小工具)

## 核心價值
Clock 的核心是提供一個「零干擾」的專注環境。它沒有複雜的選單或分心的圖表，只有最純粹的時間倒數與狀態切換。透過極簡的設計與高可自訂性，它能完美融入使用者的桌面工作空間。

## 主要功能
*   **雙階段循環**：支援自訂「工作 (Work)」與「休息 (Break)」時長。
*   **視覺化進度**：圓角矩形進度條提供直觀的時間流逝感。
*   **動態主題背景**：背景顏色會隨工作/休息階段自動切換為對應顏色的深色調，增加視覺層次感。
*   **互動式進度條**：滑鼠移入進度條時會自動高亮（變淺），提示使用者該區域可點擊進行暫停或播放。
*   **現代化圖示按鈕**：切換階段按鈕改為圖示化 (⏩) 設計，並支援滑鼠移入互動。
*   **Widget 模式**：無標題欄、置頂顯示。可自由移動至桌面任何位置。
*   **極簡交互**：
    *   點擊時間/進度條：暫停/繼續。暫停時時間數字會閃爍提醒。
    *   點擊右側按鈕：立即切換至下一個階段。
    *   滑鼠左鍵拖曳：任意移動位置。
*   **完整 GUI 設定介面**：
    *   **選色器**：提供質感色標清單，點擊即可換色並即時預覽。
    *   **字型選單**：直接從下拉選單選擇系統內建字型。
    *   **音效瀏覽**：透過瀏覽按鈕選取自定義 `.wav` 提示音。
    *   **開機啟動**：支援一鍵設定程式隨 Windows 啟動。
    *   **智慧縮放**：支援以底部中央為基準點調整視窗大小 (Window Size)。
*   **系統匣整合**：支援系統匣圖示，讓主視窗隱藏時仍能維持運作。
*   **Android 同步實時顯示**：支援 Android 手機端透過 mDNS 自動發現並同步 PC 狀態，實現雙端無縫銜接。
*   **單一目標模型架構 (Android)**：引擎改為被動計算模型，不再運行內部循環，僅根據「目標結束時間」與「現在時間」做差值。徹底消除了累積誤差與同步漂移問題。
*   **智慧電力優化與按需刷新 (Android)**：
    *   **前台模式**：UI 驅動 50ms 高頻刷新，保證圓圈旋轉與毫秒級數字流暢度。
    *   **背景模式**：Service 驅動 1s 低頻刷新（僅限螢幕開啟時），動態更新通知列。
    *   **黑畫面模式**：完全停止 App 內部循環（0% CPU 佔用），僅依賴作業系統鬧鐘 (`AlarmManager`) 喚醒。
*   **系統級預約與喚醒 (Android)**：音效觸發與階段轉場升級至 `AlarmManager.setAlarmClock()` 頂級 API，繞過 Android Doze 模式與 Pixel 激進的電力限制，確保黑畫面下轉場絕對準時。
*   **非同步轉場與音訊優化 (Android)**：轉場邏輯優先執行「階段切換」與「UI 刷新」。音效改用 **`SoundPool`** 技術，預載於記憶體並路由至「鬧鐘/通知流」，解決了藍牙耳機播放音樂時的 10 秒卡頓問題。
*   **Android 14 權限硬化**：導入 `USE_EXACT_ALARM` 權限並實作「三重退避 (Triple Fallback)」預約機制，保證在各種系統權限限制下均不崩潰且能穩定轉場。
*   **通知與視覺優化**：設置 `CATEGORY_ALARM` 並釘選通知，徹底封殺鎖屏消失問題。優化通知頻率，確保鎖屏狀態下仍能維持精準的轉場保險。
*   **負數保護與 UI 鎖定**：所有計時路徑均加入 `Math.max(0.0)` 箝位保護。移除通知列 `Chronometer` API，改由 Service 每秒寫入靜態文字，徹底封殺 `-00:01` 等異常顯示。
*   **導航與互動優化 (Android)**：導入互斥頁面管理與返回鍵 (`BackHandler`) 支援。解決了設定與同步頁面重疊造成的卡頓問題，並符合 Android 原生操作直覺。
*   **全欄位同步精度 (Android)**：同步協定完整支援 `TotalDurationSeconds`。外圈進度條現在能根據 PC 端的自定義時長精準計算百分比。
*   **服務生命週期管理 (Android)**：明確定義 App 關閉行為。使用者在多工介面滑掉 App 時，Service 與通知將會乾淨終止 (`stopSelf`)，避免殭屍通知干擾。
*   **音效熱重載**：切換音效設定時，強制卸載舊資源 (`SoundPool.unload`)，確保新音效即時生效。

## 目標用戶
*   **極簡主義者**：追求桌面整潔、不希望軟體佔用過多視覺空間的使用者。
*   **一般工作者/學生**：需要一個快速啟動、直覺操作且不需學習成本的專注工具。

## 使用者體驗
*   **初始啟動**：預設在螢幕底部中央，緊貼工作列邊緣。
*   **零侵入性**：工作時安靜待在角落，時間到時透過音效提醒。

## 成功定義
*   軟體能穩定在桌面運作而不干擾使用者主要工作。
*   使用者能透過視覺與聽覺反饋，輕鬆在工作與休息間轉換。

## 技術目標
*   單一執行檔發布，體積小、啟動快。
*   基於 MVVM 架構，程式碼易於維護與測試。
